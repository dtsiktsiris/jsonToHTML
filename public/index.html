<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="index.css" />
    <title>Document</title>
  </head>

  <body>
    <div class="container">
      <div class="leftSidebar">
        <div class="lSidebarTopBar">
          <button>Add</button>
        </div>
        <div>GET smth</div>
        <div>GET smth</div>
      </div>
      <div class="content">
        <div class="requestContainer">
          <select name="method" id="method">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
          </select>
          <input
            id="urlInput"
            type="text"
            value="https://jsonplaceholder.typicode.com/todos"
          />
          <button onclick="sendRequest()">Send</button>
        </div>
        <div id="jsonResponseHolder" class="jsonResponseHolder"></div>
      </div>
      <div id="rightSidebar" class="rightSidebar">
        <div id="variables">drop here</div>
      </div>
    </div>
  </body>
    <script src="dragDropListeners.js"></script>
  <script>
    let jsonhtml = "";
    let jsonPath = [];

    async function sendRequest() {
      jsonhtml = "";
      jsonPath = [];
      jsonPath.push("root");
      const url = document.getElementById("urlInput").value;
      const response = await fetch(url);
      const result = await response.json();
      eachRecursive(result);
      console.log(result);
      document.getElementById("jsonResponseHolder").innerHTML = jsonhtml;

      addDragstartListeners();
    }

    const jsonarray = [
      {
        userId: 1,
        id: 1,
        title: "delectus aut autem",
        completed: false,
      },
      {
        userId: 1,
        id: 2,
        title: "quis ut nam facilis et officia qui",
        completed: false,
      },
      {
        userId: 1,
        id: 3,
        title: "fugiat veniam minus",
        completed: false,
      },
    ];
    const json = {
      user: {
        id: 12345,
        username: "coder_gal",
        isActive: true,
        roles: ["admin", "editor"],
        profile: {
          firstName: "Jane",
          lastName: "Doe",
          email: "jane.doe@example.com",
        },
        settings: null,
      },
      products: [
        {
          productId: "P101",
          name: "Wireless Mouse",
          price: 25.99,
        },
        {
          productId: "P102",
          name: "Mechanical Keyboard",
          price: 79.99,
        },
      ],
    };

    const variableCard = (name, path) => {
      const card = document.createElement("div");
      card.setAttribute("class", "cardVariable");
      const nameHolder = document.createElement("div");
      const pathHolder = document.createElement("div");
      nameHolder.innerText = name;
      pathHolder.innerText = path;
      card.appendChild(nameHolder);
      card.appendChild(pathHolder);
      return card;
    };

    const generateKeyElement = (text, path) => {
      return `<span id="key" class="key"
            path="${path}"
            uid="${crypto.randomUUID()}"
            draggable="true">${text}
            </span>`;
    };

    let state = "";
    function eachRecursive(obj) {
      for (var k in obj) {
        jsonPath.push(k);
        if (typeof obj[k] == "object" && obj[k] !== null) {
          if (Array.isArray(obj[k])) {
            // jsonPath.push("dt_array_dt");
            jsonhtml +=
              '<div class="array">' +
              generateKeyElement(k, jsonPath.join(".")) +
              " [";
          } else {
            jsonhtml +=
              '<div class="object">' +
              generateKeyElement(k, jsonPath.join(".")) +
              " {";
          }
          jsonhtml += '<div class="identate">';
          eachRecursive(obj[k]);
          jsonhtml += "</div>";

          if (Array.isArray(obj[k])) {
            jsonhtml += "]";
          } else {
            jsonhtml += "}";
          }
          jsonhtml += "</div>";
        } else {
          jsonhtml += '<div class="key-value">';
          jsonhtml +=
            generateKeyElement(k, jsonPath.join(".")) + " : " + obj[k];
          jsonhtml += "</div>";
        }
        jsonPath.pop();
      }
    }

    jsonPath.push("root");
    eachRecursive(jsonarray);
    document.getElementById("jsonResponseHolder").innerHTML = jsonhtml;


    addDragstartListeners();
  </script>

</html>
