<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="index.css" />
    <title>Document</title>
  </head>

  <body>
    <div class="container">
      <div class="leftSidebar"></div>
      <div class="content">
        <div id="jsonHolder"></div>
      </div>
      <div id="rightSidebar" class="rightSidebar">
        <div id="variables">drop here</div>
      </div>
    </div>
  </body>
  <script>
    const json = {
      user: {
        id: 12345,
        username: "coder_gal",
        isActive: true,
        roles: ["admin", "editor"],
        profile: {
          firstName: "Jane",
          lastName: "Doe",
          email: "jane.doe@example.com",
        },
        settings: null,
      },
      products: [
        {
          productId: "P101",
          name: "Wireless Mouse",
          price: 25.99,
        },
        {
          productId: "P102",
          name: "Mechanical Keyboard",
          price: 79.99,
        },
      ],
    };

    const variableCard = (name) => {
      const newDiv = document.createElement("div");
      newDiv.innerText = name;
      return newDiv;
    };

    const generateKeyElement = (text) => {
      return (
        '<span id="key" class="key" uid="' +
        crypto.randomUUID() +
        '" draggable="true">' +
        text +
        "</span>"
      );
    };

    let jsonhtml = "";
    function eachRecursive(obj) {
      for (var k in obj) {
        if (typeof obj[k] == "object" && obj[k] !== null) {
          if (Array.isArray(obj[k])) {
            jsonhtml += '<div class="array">' + generateKeyElement(k) + " [";
          } else {
            jsonhtml += '<div class="object">' + generateKeyElement(k) + " {";
          }
          jsonhtml += '<div class="identate">';
          eachRecursive(obj[k]);
          if (Array.isArray(obj[k])) {
            jsonhtml += "</div>]";
          } else {
            jsonhtml += "</div>}";
          }
          jsonhtml += "</div>";
        } else {
          jsonhtml += '<div class="key-value">';
          jsonhtml += generateKeyElement(k) + " : " + obj[k];
          jsonhtml += "</div>";
        }
      }
    }

    eachRecursive(json);
    document.getElementById("jsonHolder").innerHTML = jsonhtml;

    const generateJSONPath = (uid) => {};

    const target = document.getElementById("variables");

    // Cancel dragover so that drop can fire
    target.addEventListener("dragover", (ev) => {
      ev.preventDefault();
    });
    target.addEventListener("drop", (ev) => {
      ev.preventDefault();
      const data = ev.dataTransfer.getData("application/json");
      const datao = JSON.parse(data);
      document
        .getElementById("rightSidebar")
        .appendChild(variableCard(datao.name));
      console.log(datao);
    });

    function dragstartHandler(ev) {
      // Add different types of drag data
      const name = ev.target.innerText;
      const uid = ev.target.getAttribute("uid");
      ev.dataTransfer.setData(
        "application/json",
        JSON.stringify({ name: name, uid: uid })
      );
      console.log(ev.target);
    }
    let items = document.querySelectorAll(".key");
    items.forEach(function (item) {
      item.addEventListener("dragstart", dragstartHandler);
    });
  </script>
</html>
