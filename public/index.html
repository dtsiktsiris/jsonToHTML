<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="index.css" />
    <title>Document</title>
  </head>

  <body>
    <div class="container">
      <div class="leftSidebar"></div>
      <div class="content">
        <div class="requestContainer">
          <select name="method" id="method">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
          </select>
          <input type="text">
          <button>Send</button>
        </div>
        <div id="jsonResponseHolder" class="jsonResponseHolder"></div>
      </div>
      <div id="rightSidebar" class="rightSidebar">
        <div id="variables">drop here</div>
      </div>
    </div>
  </body>
  <script>
    const json = {
      user: {
        id: 12345,
        username: "coder_gal",
        isActive: true,
        roles: ["admin", "editor"],
        profile: {
          firstName: "Jane",
          lastName: "Doe",
          email: "jane.doe@example.com",
        },
        settings: null,
      },
      products: [
        {
          productId: "P101",
          name: "Wireless Mouse",
          price: 25.99,
        },
        {
          productId: "P102",
          name: "Mechanical Keyboard",
          price: 79.99,
        },
      ],
    };

    const variableCard = (name, path) => {
      const card = document.createElement("div");
      card.setAttribute("class", "cardVariable");
      const nameHolder = document.createElement("div");
      const pathHolder = document.createElement("div");
      nameHolder.innerText = name;
      pathHolder.innerText = path;
      card.appendChild(nameHolder);
      card.appendChild(pathHolder);
      return card;
    };

    const generateKeyElement = (text, path) => {
      return `<span id="key" class="key" 
        path="${path}" 
        uid="${crypto.randomUUID()}" 
        draggable="true">${text}
        </span>`;
    };

    let jsonhtml = "";

    let jsonPath = [];
    let state = "";
    function eachRecursive(obj) {
      for (var k in obj) {
        jsonPath.push(k);
        if (typeof obj[k] == "object" && obj[k] !== null) {
          if (Array.isArray(obj[k])) {
            // jsonPath.push("dt_array_dt");
            jsonhtml +=
              '<div class="array">' +
              generateKeyElement(k, jsonPath.join(".")) +
              " [";
          } else {
            jsonhtml +=
              '<div class="object">' +
              generateKeyElement(k, jsonPath.join(".")) +
              " {";
          }
          jsonhtml += '<div class="identate">';
          eachRecursive(obj[k]);
          jsonhtml += "</div>";

          if (Array.isArray(obj[k])) {
            jsonhtml += "]";
          } else {
            jsonhtml += "}";
          }
          jsonhtml += "</div>";
        } else {
          jsonhtml += '<div class="key-value">';
          jsonhtml +=
            generateKeyElement(k, jsonPath.join(".")) + " : " + obj[k];
          jsonhtml += "</div>";
        }
        jsonPath.pop();
      }
    }

    eachRecursive(json);
    document.getElementById("jsonResponseHolder").innerHTML = jsonhtml;

    const target = document.getElementById("variables");

    const normalizePath = (path) => {
      const pathList = path.split(".");
      let normPath = [];
      for (let i = 0; i < pathList.length; i++) {
        if (!isNaN(parseFloat(pathList[i + 1]))) {
          normPath.push(pathList[i] + "[" + pathList[i + 1] + "]");
          i++;
        } else {
          normPath.push(pathList[i]);
        }
      }
      return normPath.join(".");
    };

    // Cancel dragover so that drop can fire
    target.addEventListener("dragover", (ev) => {
      ev.preventDefault();
    });
    target.addEventListener("drop", (ev) => {
      ev.preventDefault();
      const data = ev.dataTransfer.getData("application/json");
      const datao = JSON.parse(data);
      document
        .getElementById("rightSidebar")
        .appendChild(variableCard(datao.name, normalizePath(datao.path)));
      console.log(datao);
    });

    function dragstartHandler(ev) {
      // Add different types of drag data
      const name = ev.target.innerText;
      const uid = ev.target.getAttribute("uid");
      const path = ev.target.getAttribute("path");
      ev.dataTransfer.setData(
        "application/json",
        JSON.stringify({ name: name, uid: uid, path: path })
      );
      console.log(ev.target);
    }
    let items = document.querySelectorAll(".key");
    items.forEach(function (item) {
      item.addEventListener("dragstart", dragstartHandler);
    });
  </script>
</html>
